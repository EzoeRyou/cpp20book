# C++20の概要

C++20は2020年に制定された国際標準規格だ。C++は厳格に3年おきに規格を制定するスケジュールを敷いている。そのため、C++20の前の規格は2017年に制定されたC++17で、次の規格はおそらく2023年に制定されるC++23になるだろう。

近年C++が厳格に3年おきに規格を制定するようになったのは、過去の二度の失敗から学んだためだ。C++での最初の規格、C++98は1998年に制定されたが、この規格は本来、1990年台の前半までに制定できなければ失敗だと言われていた。C++11は2011年に制定されたが、この規格は本来200x年までに制定される予定であったので、C++0xと呼ばれていた。

なぜかつてのC++の規格が本来の予定を大幅に超過して制定されたかというと、スケジュール管理の目標に問題があったためだ。スケジュール管理をする場合の目標設定として以下の2つが考えられる。

+ 機能に対する目標
+ 期間に対する目標

機能を目標として設定すると、ある機能Xが完成するまでリリースができなくなる。そのため、リリース時期は機能Xが完成するまで際限なく引き伸ばされる。

期間を目標にするとどうか。期間を区切って、何日後や何ヶ月後のこの日に必ずリリースすると宣言する。その場合、納期に間に合わなかった機能は含まれなくなる。

スケジュール管理の目標は機能か期限のどちらかしか選ぶことはできず、一方を選ぶと他方は諦めなければならない。C++ではC++98とC++11で機能を目標としたスケジュール管理をしてきた。そのため、C++に入れる予定の機能が完成するまで際限なく規格制定が延期されることになった。正式に制定されていない規格は、将来変わる可能性があるので、C++コンパイラーは積極的に機能を実装しようとはせず、機能が実装されないので実装経験や利用経験も積まれず、もうそろそろ完成という段階になって新たに不具合が見つかり完成が遠のくという負のスパイラルに陥っていた。

そのため、C++14からはC++標準化委員会は厳格に3年おきに標準規格を制定するというスケジュール管理戦略を取った。ある機能が今回の3年の期限に間に合わなかったならば、次の3年に回される。「でもあと一回会議をはさめば合意が取れるから」と言い訳をして実際にそのとおりになったためしはない。間に合わなければ問答無用で次回以降に持ち越しだ。

C++20ではこのようにして次回に持ち越された成熟を重ねてきた機能が多く採用されることになった。特に大きな機能だけでも、

+ コンセプト
+ コルーチン
+ モジュール

があるし、ライブラリとしても

+ レンジ
+ std::format

がある。また、今回はconstexprの制限がさらに大幅に緩和された。この制限緩和は将来のさらなる機能追加のための布石だ。C++はまだまだ進化を続ける言語だ。

本書はC++17の知識を持っている読者を対象にC++20に追加された新機能を解説する。まだC++17までの知識を得ていない読者は、拙書「C++11/14コア言語」や「江添亮の詳説C++17」などで学ぶとよい。


